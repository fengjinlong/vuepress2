## docker
### demo
1. ⾸先创建⼀个空⽂件夹。并创建以下⽂件
>+ server.js
>- package.json
>+ Dockerfile
>- .dockerignore

2. server.js
```
const Koa = require('koa');
const app = new Koa();
app.use(async ctx => {
ctx.body = 'Hello docker';
});
app.listen(3000);
```
3. package.json
```
{
"name": "docker_demo",
"version": "0.1.0",
"private": true,
"scripts": {
"start": "node server.js"
 },
"dependencies": {
"koa": "^2.5.0"
 }
}
```
4. .dockerignore
```
# Logs
logs
*.log
npm-debug.log*
# Runtime data
pids
*.pid
*.seed
# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov
# Coverage directory used by tools like istanbul
coverage
# nyc test coverage
.nyc_output
# Grunt intermediate storage (http://gruntjs.com/creatingplugins#storing-task-files)
.grunt
# node-waf configuration
.lock-wscript
# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release
# Dependency directories
node_modules
jspm_packages
# Optional npm cache directory
.npm
# Optional REPL history
.node_repl_history
.idea
.node_modules
node_modules
.vscode
```
5. Dockerfile
```
#制定node镜像的版本
FROM node:8.9-alpine
#声明作者
MAINTAINER evilboy
#移动当前⽬录下⾯的⽂件到app⽬录下
ADD . /app/
#进⼊到app⽬录下⾯，类似cd
WORKDIR /app
#安装依赖
RUN npm install
#对外暴露的端⼝
EXPOSE 3000
#程序启动脚本
CMD ["npm", "start"]
```
6. 构建镜像,然后使⽤docker images命令查看镜像
```
docker build -t docker_demo .
```
7. 启动镜像 -d表示后台执⾏，-p 9000:3000表示指定本地的9000端⼝隐射到容器内的3000端⼝，
docker_demo为镜像名称
```
docker run -d -p 9000:3000 docker_demo
```

## ssh 启动

1. Dockerfile
```
FROM node
LABEL name="vue-back"
LABEL version="1.0"
COPY . /app
WORKDIR /app
RUN npm install
EXPOSE 3000
CMD npm start
```

2. ssh node
```
#!/bin/bash
WORK_PATH='/usr/projects/vue-front'
cd $WORK_PATH
echo "清除老代码"
git reset --hard origin/master
git clean -f
echo "拉取新代码"
git pull origin master
npm run build
echo "开始执行构建"
docker build -t vue-front:1.0 .
echo "停止旧容器并删除旧容器"
docker stop vue-front-container
docker rm vue-front-container
echo "启动新容器"
docker container run -p 8080:8080 --name vue-front-container -d vue-front:1.0
```